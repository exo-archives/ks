<%	
	import org.exoplatform.ks.common.bbcode.BBCode;
	import org.exoplatform.forum.ForumUtils;
	import org.exoplatform.forum.webui.popup.UIListTopicOld;
	import org.exoplatform.forum.webui.popup.UIPageListPostByUser;
	def jsManager = _ctx.getRequestContext().getJavascriptManager() ;
	jsManager.importJavascript('eXo.forum.webservice.SearchIpBan', '/forum/javascript/') ;
	jsManager.addJavascript('eXo.forum.webservice.SearchIpBan.init();') ;
	List bbcodes = uiform.getListBBcode();
	String classCssInbox = "";
%>
<div class="UIFormInputWithActions UIForumAdministrationForm" style="*width:97%;">	
	<% uiform.begin() %>	
	<div class="UIFormTabPane">
		<div class="UITabPane">
			<div class="TabPaneContent">
				
				<div class="WorkingArea">
					<div class="UIHorizontalTabs">
						<div class="LeftHorizontalTabs">
							<div class="RightHorizontalTabs">
								<div class="CenterHorizontalTabs">
									<div class="TabsContainer">
									<%String classCss = "SelectedTab" ; 
										int i = 0;
										String tabSelected = "";
										for(tabconten in uiform.getChildren()){ 
											if(tabconten.id.indexOf("Tab") > 0) {	
												String link = "javascript:void(0);";
												if(uiform.getIsSelected(i)){
													 classCss = "SelectedTab" ;
													 tabSelected = tabconten.getId();
												}
												else {
													classCss = "NormalTab" ;
													link = uicomponent.event("SelectTab",""+i) ;
												}
									%>	
										<div class="UITab NormalTabStyle">
											<div class="$classCss">
												<div class="LeftTab">
													<div class="RightTab">
															<div class="MiddleTab" onclick="$link"><%= _ctx.appRes(uiform.id + ".label." + tabconten.id); %></div>													
													</div>
												</div>
											</div>
										</div>
									<%++i;}
										} %>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="UIForm">
						<div class="HorizontalLayout">
							<div class="UITabContentContainer">
								<% 
									String display =	"block";
									int j = 0;
									for(tabconten in uiform.getChildren()){
										if(tabconten.id.indexOf("Tab") > 0) {
											if(uiform.getIsSelected(j))display =	"block";
											else display = "none";
								%>
								<div style="display:$display;" id="UITabContent" class="UITabContent">
									<%if(tabconten.id.equals(uicomponent.IP_BAN_TAB)){%>
										<center>
											<div style="width:400px;">
												<div class="UIQuickSearchForm" style="padding-bottom:10px;">
													<div style="float:left;">
														<%=_ctx.appRes("UIForumAdministrationForm.label.Filter")%>:&nbsp;
														<% uiform.renderField(tabconten.getChildById(uicomponent.SEARCH_IP_BAN)) ;%>
													</div>
													<div style="clear:left;"><span></span></div>
												</div>
												<table class="UIGrid" width="100%">
													<tbody>
														<tr >
															<th style="text-align:center"><%=_ctx.appRes("UIForumAdministrationForm.label.IP")%></th>
															<th><span></span></th>
														</tr>	
														<tr style="background:#edf3ee">
															<td class="FieldLabel">
																<% uiform.renderField(tabconten.getChildById(uicomponent.NEW_IP_BAN_INPUT1)) ;%>*
																<% uiform.renderField(tabconten.getChildById(uicomponent.NEW_IP_BAN_INPUT2)) ;%>*
																<% uiform.renderField(tabconten.getChildById(uicomponent.NEW_IP_BAN_INPUT3)) ;%>*
																<% uiform.renderField(tabconten.getChildById(uicomponent.NEW_IP_BAN_INPUT4)) ;%>
															</td>
															<td class="FieldLabel" align="center">
																<a href="<%=uicomponent.event("AddIp")%>">
																	[<%=_ctx.appRes("UIForumAdministrationForm.label.Add")%>]
																</a>
															</td>
														</tr>
													<%
														String color = "#ffffff";
														t= 0;
														for(ip in uicomponent.getListIpBan()){
															if(t/2 == 0) color = "#ffffff";
															else color = "#edf3ee";
															String unBanLink = "javascript:if(confirm('" + _ctx.appRes("UIBanIPForumManagerForm.confirm.UnBanIP") + "'))" + uicomponent.event("UnBan", ip);
													%>
														<tr style="background:$color" class="IpBanItem">
															<td class="FieldLabel">$ip</td>
															<td class="FieldLabel" align="center">
																	[<a href="<%=uicomponent.event("Posts", ip)%>">
																			<%=_ctx.appRes("UIForumAdministrationForm.label.Posts")%>
																	 </a>]&nbsp;
																	[<a style="color:red;" href="$unBanLink">
																			X
																	 </a>]
															</td>
														</tr>
													<%}%>
													</tbody>
												</table>
											</div>
											<div style="overflow:auto; width:400px;">
											<% 
												uiform.renderChild(uiform.BAN_IP_PAGE_ITERATOR);
											%>
												<div style="clear:right;"><span></span></div>
											</div>
										</center>
									<%}else if(tabconten.id.equals(uicomponent.FIELD_NOTIFYEMAIL_TAB)){
									%>
											<div style="white-space:none; width:100%;">
												<%uiform.renderChild(tabconten.id) ;%>
											</div>
									<%} else if(tabconten.id.equals(uicomponent.FIELD_BBCODE_TAB)) {%>
											<div style="padding:0px 16px 0px 1px;">
												<table cellspacing="0" cellpadding="0" border="0" class="UIGrid">
													<thead>
														<tr>
															<th style="width:80px; text-align:center"><%=_ctx.appRes("UIForumAdministrationForm.label.TAG");%></th>
															<th><%=_ctx.appRes("UIForumAdministrationForm.label.Description");%></th>
															<th width="40px"><%=_ctx.appRes("UIForumAdministrationForm.label.Active");%></th>
															<th width="60px"><%=_ctx.appRes("UIForumAdministrationForm.label.Action");%></th>
														</tr>
													</thead>
												</table>
											</div>
											<div class="BBCodeContainer">
												<table cellspacing="0" cellpadding="0" border="0" class="UIGrid">
													<tbody>
													<%
														int l = 0;
														for(bbcode in bbcodes) {
															if(l%2 == 0) classCssInbox = "whileRow";
															else classCssInbox = "OddRow";
															++l;
															String value = "false";
															String tagId = bbcode.getId();
															String checked = "";
															if(bbcode.isActive()){
																checked = "checked=\"checked\"";
																value = "true";
															}
													%>				
														<tr class="$classCssInbox">
															<td style="width:80px;text-align:center">
																<span><%=bbcode.getTagName();%></span>
																<% if(bbcode.isOption()) {%>
																<span>(<%=_ctx.appRes("UIForumAdministrationForm.label.Option");%>)</span>
																<% } %>
															</td>
															<td style="text-align:left"><%=bbcode.getDescription();%></td>
															<td style="width:40px;text-align:center"><input type="checkbox" class="checkbox" value="$value" name="$tagId" $checked/></td>
															<td style="width:60px;text-align:center">
																<div class="ActionContainer" style="margin:0px auto; width:42px;">
																	<div style="cursor:pointer; float:left; margin:2px;" onclick="<%=uiform.event("EditBBCode", tagId)%>">
																		 <div title="<%=_ctx.appRes("UIForumAdministrationForm.label.EditBBCode");%>" class="Icon16x16 EditIcon"><span></span></div>							
																	</div>
																	<div style="cursor:pointer; float:left; margin:2px;" onclick="if(confirm('<%=_ctx.appRes("UIForumAdministrationForm.msg.confirm-delete-BBCode")%>')){<%=uiform.event("DeleteBBCode", tagId)%>;}">
																		 <div title="<%=_ctx.appRes("UIForumAdministrationForm.label.DeleteBBCode");%>" class="Icon16x16 DeleteIcon"><span></span></div>							
																	</div>
																	<div style="clear:left;"><span></span></div>
																</div>
															</td>
														</tr>
													<%} %>
													</tbody>
												</table>
											</div>
											<div class="UIAction"> 
												<table class="ActionContainer">
													<tr>
														<td align="center">
														<%	
															 String link = uiform.event("AddNewBBCode") ;
														%>
															 <div onclick="$link" class="ActionButton LightBlueStyle">
																 <div class="ButtonLeft">
																	 <div class="ButtonRight">
																	 	 <div class="ButtonMiddle">
																		 	 <a href="javascript:void(0);"><%=_ctx.appRes("UIForumAdministrationForm.label.AddBBcode");%></a>
																	 	 </div>
																	 </div>
																 </div>
															 </div>
														 </td>
													</tr>
										 		</table> 
											</div>
									<%} else if(tabconten.id.equals(uicomponent.FIELD_AUTOPRUNE_TAB)) {
									%>
										<div class="AutuPruneContainer">
											<div id="AutuPruneContainer" style="padding:0px 16px 0px 1px;">
												<table cellspacing="0" cellpadding="0" border="0" class="UIGrid">
													<thead>
														<tr>
															<th style="width:120px; text-align:center"><%=_ctx.appRes("UIForumAdministrationForm.label.Category");%></th>
															<th style="width:120px; text-align:center"><%=_ctx.appRes("UIForumAdministrationForm.label.Forum");%></th>
															<th width="40px"><%=_ctx.appRes("UIForumAdministrationForm.label.Active");%></th>
															<th><%=_ctx.appRes("UIForumAdministrationForm.label.LastRun");%> </th>
															<th width="60px"><%=_ctx.appRes("UIForumAdministrationForm.label.Action");%></th>
														</tr>
													</thead>
												</table>
											</div>
											<div class="BBCodeContainer" id="TableContent" style="padding:1px;width:100%;">
												<table cellspacing="0" cellpadding="0" border="0" class="UIGrid" id="UIGrid">
													<tbody>
														<%  
															List pruneSettings = uicomponent.getPruneSettings();
															int t_ = 0;
															String cateTemp = " ";
															for(pruneSetting  in pruneSettings) {
																String categoryName = pruneSetting.getCategoryName();
																String forumName = pruneSetting.getForumName();
																String pruneId = pruneSetting.getId();
																String lastRun = "";
																if(pruneSetting.getLastRunDate() != null){
																	lastRun = ForumUtils.getFormatDate("dd-MM-yyyy HH:mm", pruneSetting.getLastRunDate()) + " GMT+0" ;
																}
																String value = "false";
																String checked = "";
																if(pruneSetting.isActive()){
																	checked = "checked=\"checked\"";
																	value = "true";
																}
																if(t_%2 == 0) classCssInbox = "whileRow";
																else classCssInbox = "OddRow";
																++t_;
																if(categoryName.equals(cateTemp)) {
														%>
														<tr class="$classCssInbox">
															<td style="width:120px; text-align:center">$categoryName</th>
															<td style="width:120px; text-align:center">$forumName</th>
															<td width="40px"><div onclick="<%=uiform.event("ActivatePrune", pruneId)%>"><input type="checkbox" class="checkbox" value="$value" name="$pruneId" $checked/></div></th>
															<td>$lastRun</th>
															<td width="60px">
																<div class="ActionContainer" style="margin:0px auto; width:52px;">
																	<div style="cursor:pointer; float:left; margin:2px;" onclick="<%=uiform.event("PruneSetting", pruneId)%>">
																		 <div title="<%=_ctx.appRes("UIForumAdministrationForm.label.PruneSetting");%>" class="PruneSettingIcon"><span></span></div>							
																	</div>
																	<div style="cursor:pointer; float:left; margin:2px;" onclick="<%=uiform.event("RunPrune", pruneId)%>">
																		 <div title="<%=_ctx.appRes("UIForumAdministrationForm.label.Run");%>" class="RunIcon"><span></span></div>							
																	</div>
																	<div style="clear:left;"><span></span></div>
																</div>
															</th>
														</tr>
															<% } else { %>
														<tr class="$classCssInbox">
															<td style="width:120px; text-align:center"><b>$categoryName</b></th>
															<td style="width:120px; text-align:center"> </th>
															<td width="40px"> </th>
															<td> </th>
															<td width="60px"> </th>
														</tr>
																<% if(classCssInbox.equals("whileRow")) 
																			classCssInbox = "OddRow";
																	 else classCssInbox = "whileRow";
																	++t_;
																%>
														<tr class="$classCssInbox">
															<td style="width:120px; text-align:center">$categoryName</th>
															<td style="width:120px; text-align:center">$forumName</th>
															<td width="40px"><div onclick="<%=uiform.event("ActivatePrune", pruneId)%>"><input type="checkbox" class="checkbox" value="$value" name="$pruneId" $checked/></div></th>
															<td>$lastRun</th>
															<td width="60px">
																<div class="ActionContainer" style="margin:0px auto; width:52px;">
																	<div style="cursor:pointer; float:left; margin:2px;" onclick="<%=uiform.event("PruneSetting", pruneId)%>">
																		 <div title="<%=_ctx.appRes("UIForumAdministrationForm.label.PruneSetting");%>" class="PruneSettingIcon"><span></span></div>							
																	</div>
																	<div style="cursor:pointer; float:left; margin:2px;" onclick="<%=uiform.event("RunPrune", pruneId)%>">
																		 <div title="<%=_ctx.appRes("UIForumAdministrationForm.label.Run");%>" class="RunIcon"><span></span></div>							
																	</div>
																	<div style="clear:left;"><span></span></div>
																</div>
															</th>
														</tr>
															<%}
																cateTemp = categoryName;
															%>
														<%} %>
													</tbody>
												</table>
											</div>
										</div>
										<% jsManager.addJavascript("eXo.forum.UIForumPortlet.setAutoScrollTable('TableContent','UIGrid');") ; %>
									 <%} else if(tabconten.id.equals(uicomponent.FIELD_TOPICTYPEMANAGER_TAB)) { %>
										<div class="AutuPruneContainer">
											<div id="AutuPruneContainer" style="padding:0px 16px 0px 1px;">
												<table cellspacing="0" cellpadding="0" border="0" class="UIGrid">
													<thead>
														<tr>
															<th style="width:60px; text-align:center"><%=_ctx.appRes("UIForumAdministrationForm.label.Icon");%></th>
															<th style="text-align:left"><%=_ctx.appRes("UIForumAdministrationForm.label.TypeName");%></th>
															<th width="80px"><%=_ctx.appRes("UIForumAdministrationForm.label.Action");%></th>
														</tr>
													</thead>
												</table>
											</div>
											<div class="BBCodeContainer" id="TableContent1" style="padding:1px;width:100%;">
												<table cellspacing="0" cellpadding="0" border="0" class="UIGrid" id="UIGrid1">
													<tbody>
													<% 
															List topicTypes = uicomponent.getTopicTypes();
															int k_ = 0; 
															for(topicType in topicTypes) {
																String topicTId = topicType.getId();
																if(k_%2 == 0) classCssInbox = "whileRow";
																else classCssInbox = "OddRow";
																++k_;
													%>
														<tr>
															<td style="width:60px; text-align:center"><div class="Icon16x16 <%=topicType.getIcon()%>" style="margin:auto"><span></span></div></td>
															<td style="text-align:left"><%=topicType.getName()%></td>
															<td width="80px">
																<div class="ActionContainer" style="margin:0px auto; width:60px;">
																	<div style="cursor:pointer; float:left; margin:4px;" onclick="<%=uiform.event("EditTopicType", topicTId)%>">
																		 <div title="<%=_ctx.appRes("UIForumAdministrationForm.label.EditThisTopicType");%>." class="Icon16x16 EditIcon"><span></span></div>							
																	</div>
																	<div style="cursor:pointer; float:left; margin:4px;" onclick="<%=uiform.event("DeleteTopicType", topicTId)%>">
																		 <div title="<%=_ctx.appRes("UIForumAdministrationForm.label.DeleteThisTopicType");%>" class="Icon16x16 DeleteIcon"><span></span></div>							
																	</div>
																	<div style="clear:left;"><span></span></div>
																</div>
															</td>
														</tr>
													<%  } %>
													</tbody>
												</table>
											</div>
											<div class="UIAction"> 
												<table class="ActionContainer">
													<tr>
														<td align="center">
															 <div onclick="<%=uiform.event("AddTopicType");%>" class="ActionButton LightBlueStyle">
																 <div class="ButtonLeft">
																	 <div class="ButtonRight">
																	 	 <div class="ButtonMiddle">
																		 	 <a href="javascript:void(0);"><%=_ctx.appRes("UIForumAdministrationForm.label.AddTopicType");%></a>
																	 	 </div>
																	 </div>
																 </div>
															 </div>
														 </td>
													</tr>
										 		</table> 
											</div>
										</div>			
										<% jsManager.addJavascript("eXo.forum.UIForumPortlet.setAutoScrollTable('TableContent1','UIGrid1');") ; %>			
									 <%} else {
											uiform.renderChild(tabconten.id) ; 
										}
									 %>
								</div>
								<%	 ++j;
										}
									}%>
							</div>
						</div>
					</div>
				</div>
			</div>	
		</div>	
	</div>
	
	<div class="UIAction"> 
		<table class="ActionContainer">
			<tr>
				<td align="center">
				<%for(action in uiform.getActions()) { 
						if(tabSelected.equals(uicomponent.IP_BAN_TAB)){
							if(action.equals("Save")) continue ;
						}
						String actionLabel = _ctx.appRes(uiform.getName() + ".action." + action); 
						String link = uiform.event(action) ;
				%>
					<div onclick="$link" class="ActionButton LightBlueStyle">
						<div class="ButtonLeft">
							<div class="ButtonRight">
								<div class="ButtonMiddle">
									<a href="javascript:void(0);">$actionLabel</a>
								</div>
							</div>
						</div>
					</div>
				<%}%>
				</td>
			</tr>
 		</table> 
	</div>	
	<%uiform.end()%>
</div>